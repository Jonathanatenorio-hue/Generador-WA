<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ExpertCell | Generador de Mensajes WhatsApp</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box}
:root{
  --bg:#0B1120;--bg2:#0F172A;--bg3:rgba(15,23,42,0.7);
  --card:rgba(15,23,42,0.85);--card-border:rgba(100,116,139,0.12);
  --att:#009FDB;--att-dark:#0057B8;--att-navy:#1A1F3A;
  --text:#E2E8F0;--text2:#CBD5E1;--text3:#94A3B8;--text4:#64748B;
  --green:#10B981;--red:#EF4444;--yellow:#F59E0B;--blue:#3B82F6;
  --orange:#FF6B35;--purple:#8B5CF6;
  --input-bg:rgba(30,41,59,0.6);--input-border:rgba(100,116,139,0.25);
  --wa-light:#DCF8C6;--wa-dark:#075E54;--wa-green:#25D366;
}
body{font-family:'DM Sans',system-ui,sans-serif;background:var(--bg);color:var(--text);min-height:100vh}
input,select,textarea,button{font-family:inherit}
::-webkit-scrollbar{width:5px}::-webkit-scrollbar-track{background:transparent}::-webkit-scrollbar-thumb{background:rgba(100,116,139,0.3);border-radius:3px}

.app{max-width:1200px;margin:0 auto;padding:20px 24px}

/* Header */
.header{display:flex;justify-content:space-between;align-items:center;margin-bottom:24px;padding-bottom:16px;border-bottom:1px solid rgba(0,159,219,0.1)}
.brand{display:flex;align-items:center;gap:14px}
.brand-icon{width:42px;height:42px;border-radius:12px;background:linear-gradient(135deg,var(--att),var(--att-dark));display:flex;align-items:center;justify-content:center}
.brand-icon svg{width:22px;height:22px;color:white;fill:none;stroke:white;stroke-width:2}
.brand-text .label{font-size:10px;font-weight:700;letter-spacing:3px;color:var(--att);text-transform:uppercase}
.brand-text h1{font-size:18px;font-weight:800;color:var(--text);letter-spacing:-0.3px}
.agent-badge{display:flex;align-items:center;gap:8px;padding:8px 14px;background:rgba(0,159,219,0.08);border:1px solid rgba(0,159,219,0.15);border-radius:10px}
.agent-badge .dot{width:8px;height:8px;border-radius:50%;background:var(--green)}
.agent-badge span{font-size:12px;color:var(--text2);font-weight:500}

/* Layout */
.layout{display:grid;grid-template-columns:380px 1fr;gap:24px;align-items:start}

/* Input Panel */
.panel{background:var(--bg2);border:1px solid var(--card-border);border-radius:16px;padding:24px;position:sticky;top:20px}
.panel-title{font-size:14px;font-weight:700;color:var(--text);margin-bottom:4px;display:flex;align-items:center;gap:8px}
.panel-sub{font-size:11px;color:var(--text4);margin-bottom:20px}
.field{margin-bottom:16px}
.field label{display:block;font-size:11px;font-weight:600;color:var(--text3);margin-bottom:5px;letter-spacing:.5px;text-transform:uppercase}
.field input,.field select{width:100%;padding:11px 14px;background:var(--input-bg);border:1px solid var(--input-border);border-radius:10px;color:var(--text);font-size:13px;outline:none;transition:border .2s}
.field input:focus,.field select:focus{border-color:var(--att)}
.field input::placeholder{color:var(--text4)}
.field-row{display:grid;grid-template-columns:1fr 1fr;gap:12px}

/* Scenario buttons */
.scenarios{display:flex;flex-direction:column;gap:6px;margin-top:16px}
.scenario-label{font-size:11px;font-weight:600;color:var(--text3);letter-spacing:.5px;text-transform:uppercase;margin-bottom:4px}
.scenario-btn{display:flex;align-items:center;gap:10px;width:100%;padding:12px 14px;background:rgba(30,41,59,0.4);border:1px solid rgba(100,116,139,0.15);border-radius:10px;color:var(--text2);font-size:13px;font-weight:500;cursor:pointer;transition:all .15s;text-align:left}
.scenario-btn:hover{background:rgba(0,159,219,0.06);border-color:rgba(0,159,219,0.2)}
.scenario-btn.active{background:rgba(0,159,219,0.1);border-color:rgba(0,159,219,0.3);color:var(--att);font-weight:600}
.scenario-btn .emoji{font-size:16px;width:24px;text-align:center;flex-shrink:0}
.scenario-btn .count{margin-left:auto;font-size:10px;color:var(--text4);background:rgba(100,116,139,0.15);padding:2px 7px;border-radius:10px}

/* Generate button */
.btn-generate{width:100%;padding:14px;background:linear-gradient(135deg,var(--wa-green),#128C7E);border:none;border-radius:12px;color:white;font-size:14px;font-weight:700;cursor:pointer;transition:all .2s;margin-top:16px;letter-spacing:.3px;display:flex;align-items:center;justify-content:center;gap:8px}
.btn-generate:hover{transform:translateY(-1px);box-shadow:0 8px 25px rgba(37,211,102,0.25)}
.btn-generate:disabled{opacity:.4;cursor:default;transform:none;box-shadow:none}
.btn-generate svg{width:18px;height:18px}

/* Results Panel */
.results{min-height:400px}
.results-empty{display:flex;flex-direction:column;align-items:center;justify-content:center;min-height:400px;text-align:center;padding:40px}
.results-empty .icon{width:80px;height:80px;border-radius:20px;background:rgba(0,159,219,0.06);display:flex;align-items:center;justify-content:center;margin-bottom:16px}
.results-empty .icon svg{width:36px;height:36px;stroke:var(--att);fill:none;stroke-width:1.5}
.results-empty h3{font-size:16px;font-weight:700;color:var(--text);margin-bottom:6px}
.results-empty p{font-size:13px;color:var(--text4);max-width:300px}

/* Comparison card */
.comparison{background:var(--bg2);border:1px solid var(--card-border);border-radius:14px;padding:18px 20px;margin-bottom:16px;animation:slideUp .4s ease}
.comparison-title{font-size:11px;font-weight:700;color:var(--att);letter-spacing:1px;text-transform:uppercase;margin-bottom:12px}
.compare-grid{display:grid;grid-template-columns:1fr auto 1fr;gap:12px;align-items:center}
.compare-box{padding:14px;border-radius:10px;text-align:center}
.compare-box.old{background:rgba(239,68,68,0.06);border:1px solid rgba(239,68,68,0.12)}
.compare-box.new{background:rgba(16,185,129,0.06);border:1px solid rgba(16,185,129,0.12)}
.compare-box .box-label{font-size:9px;font-weight:700;letter-spacing:1px;text-transform:uppercase;margin-bottom:6px}
.compare-box.old .box-label{color:var(--red)}
.compare-box.new .box-label{color:var(--green)}
.compare-box .plan-name{font-size:13px;font-weight:700;color:var(--text);margin-bottom:4px}
.compare-box .plan-price{font-size:22px;font-weight:800;margin-bottom:2px}
.compare-box.old .plan-price{color:var(--red)}
.compare-box.new .plan-price{color:var(--green)}
.compare-box .plan-data{font-size:11px;color:var(--text3)}
.compare-arrow{font-size:24px;color:var(--att)}
.savings-strip{display:flex;justify-content:center;gap:20px;margin-top:12px;padding-top:12px;border-top:1px solid rgba(100,116,139,0.1)}
.saving-item{text-align:center}
.saving-item .val{font-size:16px;font-weight:800}
.saving-item .lbl{font-size:9px;color:var(--text4);text-transform:uppercase;letter-spacing:.5px}

/* Message cards */
.msg-card{background:var(--bg2);border:1px solid var(--card-border);border-radius:14px;margin-bottom:14px;overflow:hidden;animation:slideUp .4s ease}
.msg-header{display:flex;justify-content:space-between;align-items:center;padding:14px 18px;border-bottom:1px solid rgba(100,116,139,0.08)}
.msg-header .tag{font-size:10px;font-weight:700;padding:4px 10px;border-radius:6px;letter-spacing:.5px;text-transform:uppercase}
.tag-a{background:rgba(0,159,219,0.12);color:var(--att)}
.tag-b{background:rgba(139,92,246,0.12);color:var(--purple)}
.tag-c{background:rgba(16,185,129,0.12);color:var(--green)}
.tag-d{background:rgba(245,158,11,0.12);color:var(--yellow)}
.btn-copy{display:flex;align-items:center;gap:6px;padding:7px 14px;background:rgba(37,211,102,0.1);border:1px solid rgba(37,211,102,0.2);border-radius:8px;color:var(--wa-green);font-size:11px;font-weight:600;cursor:pointer;transition:all .15s}
.btn-copy:hover{background:rgba(37,211,102,0.18)}
.btn-copy.copied{background:var(--wa-green);color:white;border-color:var(--wa-green)}
.btn-copy svg{width:14px;height:14px}

/* WhatsApp bubble */
.wa-bubble-container{padding:18px;background:linear-gradient(135deg,#ECE5DD 0%,#D5DBDB 100%);position:relative}
.wa-bubble-container::before{content:'';position:absolute;inset:0;background:url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23b0bec5' fill-opacity='0.08'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E")}
.wa-bubble{position:relative;background:var(--wa-light);border-radius:0 12px 12px 12px;padding:12px 14px;max-width:90%;font-size:13px;line-height:1.55;color:#1a1a1a;box-shadow:0 1px 3px rgba(0,0,0,0.08);white-space:pre-wrap;word-wrap:break-word}
.wa-bubble::before{content:'';position:absolute;top:0;left:-8px;border-width:0 8px 8px 0;border-style:solid;border-color:transparent var(--wa-light) transparent transparent}
.wa-time{text-align:right;font-size:10px;color:#8696a0;margin-top:4px}

/* Scenario tip */
.scenario-tip{display:flex;gap:10px;align-items:flex-start;padding:12px 16px;background:rgba(245,158,11,0.06);border:1px solid rgba(245,158,11,0.15);border-radius:10px;margin-bottom:14px;animation:slideUp .3s ease}
.scenario-tip .tip-icon{font-size:16px;flex-shrink:0;margin-top:1px}
.scenario-tip .tip-text{font-size:11px;color:var(--text2);line-height:1.5}
.scenario-tip .tip-text b{color:var(--yellow)}

@keyframes slideUp{from{opacity:0;transform:translateY(12px)}to{opacity:1;transform:translateY(0)}}

/* Responsive */
@media(max-width:860px){.layout{grid-template-columns:1fr}.panel{position:static}}

/* Tabs */
.tabs{display:flex;gap:4px;margin-bottom:20px;background:rgba(15,23,42,0.6);padding:4px;border-radius:12px;border:1px solid var(--card-border)}
.tab-btn{flex:1;padding:11px 16px;background:transparent;border:none;border-radius:9px;color:var(--text3);font-size:13px;font-weight:600;cursor:pointer;transition:all .15s;display:flex;align-items:center;justify-content:center;gap:8px}
.tab-btn.active{background:linear-gradient(135deg,var(--att),var(--att-dark));color:white;box-shadow:0 4px 15px rgba(0,159,219,0.25)}
.tab-btn:hover:not(.active){background:rgba(0,159,219,0.06);color:var(--text2)}
.tab-btn svg{width:16px;height:16px}
.tab-content{display:none}.tab-content.active{display:block}

/* Mass panel adjustments */
.mass-layout{display:grid;grid-template-columns:380px 1fr;gap:24px;align-items:start}
.mass-info{display:flex;gap:10px;align-items:flex-start;padding:12px 14px;background:rgba(0,159,219,0.06);border:1px solid rgba(0,159,219,0.12);border-radius:10px;margin-bottom:16px}
.mass-info .info-icon{font-size:16px;flex-shrink:0}
.mass-info .info-text{font-size:11px;color:var(--text2);line-height:1.5}
.mass-info .info-text b{color:var(--att)}
.mass-scenario-btn{display:flex;align-items:center;gap:10px;width:100%;padding:11px 14px;background:rgba(30,41,59,0.4);border:1px solid rgba(100,116,139,0.15);border-radius:10px;color:var(--text2);font-size:13px;font-weight:500;cursor:pointer;transition:all .15s;text-align:left;margin-bottom:6px}
.mass-scenario-btn:hover{background:rgba(0,159,219,0.06);border-color:rgba(0,159,219,0.2)}
.mass-scenario-btn.active{background:rgba(0,159,219,0.1);border-color:rgba(0,159,219,0.3);color:var(--att);font-weight:600}
.mass-scenario-btn .emoji{font-size:16px;width:24px;text-align:center;flex-shrink:0}

/* Toast */
.toast{position:fixed;bottom:30px;left:50%;transform:translateX(-50%) translateY(80px);background:var(--wa-green);color:white;padding:12px 24px;border-radius:12px;font-size:13px;font-weight:600;z-index:100;transition:transform .3s ease;box-shadow:0 8px 30px rgba(37,211,102,0.3);display:flex;align-items:center;gap:8px}
.toast.show{transform:translateX(-50%) translateY(0)}
.toast svg{width:16px;height:16px}
</style>
</head>
<body>

<div class="app">
  <!-- Header -->
  <div class="header">
    <div class="brand">
      <div class="brand-icon">
        <svg viewBox="0 0 24 24"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z" stroke-linecap="round" stroke-linejoin="round"/></svg>
      </div>
      <div class="brand-text">
        <div class="label">ExpertCell</div>
        <h1>Generador de Mensajes WhatsApp</h1>
      </div>
    </div>
    <div class="agent-badge">
      <div class="dot"></div>
      <span>Agente conectado</span>
    </div>
  </div>

  <!-- Tabs -->
  <div class="tabs">
    <button class="tab-btn active" onclick="switchTab('personal')">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/></svg>
      Mensaje Personalizado
    </button>
    <button class="tab-btn" onclick="switchTab('masivo')">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
      Mensaje Masivo
    </button>
  </div>

  <!-- TAB 1: Personalizado -->
  <div class="tab-content active" id="tab-personal">
  <!-- Layout -->
  <div class="layout">
    <!-- Input Panel -->
    <div class="panel">
      <div class="panel-title">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/></svg>
        Datos del Cliente
      </div>
      <div class="panel-sub">Ingresa la informacion del cliente para generar mensajes personalizados</div>

      <div class="field">
        <label>Nombre del cliente</label>
        <input type="text" id="clientName" placeholder="Ej. Juan Perez">
      </div>
      <div class="field">
        <label>Plan anterior del cliente</label>
        <select id="planAnterior">
          <option value="">Seleccionar plan...</option>
          <optgroup label="Con Todo (Nextel/Iusacell)">
            <option value="Con Todo 399">Con Todo 399 â€” $434/mes â€” 2 GB</option>
            <option value="Con Todo 499">Con Todo 499 â€” $534/mes â€” 3 GB</option>
            <option value="Con Todo 549">Con Todo 549 â€” $584/mes â€” 5 GB</option>
            <option value="Con Todo 599">Con Todo 599 â€” $634/mes â€” 6 GB</option>
            <option value="Con Todo 699">Con Todo 699 â€” $744/mes â€” 6 GB</option>
            <option value="Con Todo 799">Con Todo 799 â€” $844/mes â€” 8 GB</option>
            <option value="Con Todo 999">Con Todo 999 â€” $1,044/mes â€” 10 GB</option>
          </optgroup>
          <optgroup label="Consiguelo">
            <option value="Consiguelo 2">Consiguelo 2 â€” $404/mes â€” 2 GB</option>
            <option value="Consiguelo 3">Consiguelo 3 â€” $541/mes â€” 3 GB</option>
            <option value="Consiguelo 5">Consiguelo 5 â€” $667/mes â€” 5 GB</option>
            <option value="Consiguelo 6.5">Consiguelo 6.5 â€” $772/mes â€” 6.5 GB</option>
            <option value="Consiguelo 8">Consiguelo 8 â€” $887/mes â€” 8 GB</option>
            <option value="Consiguelo 10">Consiguelo 10 â€” $992/mes â€” 10 GB</option>
            <option value="Consiguelo 13">Consiguelo 13 â€” $1,202/mes â€” 13 GB</option>
            <option value="Consiguelo 20">Consiguelo 20 â€” $1,853/mes â€” 20 GB</option>
          </optgroup>
          <optgroup label="Armalo">
            <option value="Armalo 5">Armalo 5 â€” $419/mes â€” 5 GB</option>
            <option value="Armalo 8">Armalo 8 â€” $524/mes â€” 8 GB</option>
            <option value="Armalo 9">Armalo 9 â€” $629/mes â€” 9 GB</option>
            <option value="Armalo 10">Armalo 10 â€” $629/mes â€” 10 GB</option>
            <option value="Armalo 11">Armalo 11 â€” $681/mes â€” 11 GB</option>
            <option value="Armalo 12">Armalo 12 â€” $681/mes â€” 12 GB</option>
            <option value="Armalo 14">Armalo 14 â€” $786/mes â€” 14 GB</option>
            <option value="Armalo 17">Armalo 17 â€” $891/mes â€” 17 GB</option>
            <option value="Armalo 20">Armalo 20 â€” $996/mes â€” 20 GB</option>
            <option value="Armalo 26">Armalo 26 â€” $1,101/mes â€” 26 GB</option>
            <option value="Armalo 40">Armalo 40 â€” $1,574/mes â€” 40 GB</option>
          </optgroup>
        </select>
      </div>
      <div class="field">
        <label>Renta mensual actual (si difiere del estandar)</label>
        <input type="text" id="rentaOverride" placeholder="Dejar vacio para usar la renta del plan">
      </div>
      <div class="field">
        <label>Plan Premium a ofrecer</label>
        <select id="premiumPlan">
          <option value="auto">ğŸ¤– Automatico (mejor opcion segun precio)</option>
          <option value="AT&T Azul 2">AT&T Azul 2 â€” $419/mes â€” 8 GB</option>
          <option value="AT&T Azul 3">AT&T Azul 3 â€” $529/mes â€” 12 GB</option>
          <option value="AT&T Plata">AT&T Plata â€” $629/mes â€” 25 GB</option>
          <option value="AT&T Oro">AT&T Oro â€” $699/mes â€” 40 GB</option>
          <option value="AT&T Black">AT&T Black â€” $799/mes â€” 45 GB</option>
          <option value="AT&T Platino">AT&T Platino â€” $999/mes â€” 50 GB</option>
          <option value="AT&T Diamante">AT&T Diamante â€” $1,259/mes â€” 50 GB</option>
        </select>
        <div id="premium-hint" style="font-size:10px;color:var(--text4);margin-top:4px"></div>
      </div>
      <div class="field">
        <label>Tu nombre (agente)</label>
        <input type="text" id="agentName" placeholder="Ej. Carlos">
      </div>

      <div class="scenario-label">Escenario del mensaje</div>
      <div class="scenarios">
        <button class="scenario-btn active" data-scenario="primer_contacto" onclick="selectScenario(this)">
          <span class="emoji">ğŸ‘‹</span> Primer contacto <span class="count">4 msgs</span>
        </button>
        <button class="scenario-btn" data-scenario="seguimiento" onclick="selectScenario(this)">
          <span class="emoji">ğŸ”„</span> Seguimiento (no contesto) <span class="count">4 msgs</span>
        </button>
        <button class="scenario-btn" data-scenario="cierre" onclick="selectScenario(this)">
          <span class="emoji">ğŸ”¥</span> Cierre / urgencia <span class="count">4 msgs</span>
        </button>
        <button class="scenario-btn" data-scenario="tienda" onclick="selectScenario(this)">
          <span class="emoji">ğŸª</span> Prefiere ir a tienda <span class="count">4 msgs</span>
        </button>
      </div>

      <button class="btn-generate" id="btnGenerate" onclick="generateMessages()">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>
        Generar Mensajes de WhatsApp
      </button>
    </div>

    <!-- Results -->
    <div class="results" id="results">
      <div class="results-empty">
        <div class="icon">
          <svg viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>
        </div>
        <h3>Genera mensajes poderosos</h3>
        <p>Ingresa los datos del cliente, selecciona el escenario y presiona generar. Tendras 2 opciones listas para copiar y enviar por WhatsApp.</p>
      </div>
    </div>
  </div>
  </div><!-- end tab-personal -->

  <!-- TAB 2: Masivo -->
  <div class="tab-content" id="tab-masivo">
    <div class="mass-layout">
      <!-- Mass Input Panel -->
      <div class="panel">
        <div class="panel-title">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
          Mensaje Masivo
        </div>
        <div class="panel-sub">Genera mensajes genericos para enviar a un grupo de clientes con el mismo plan</div>

        <div class="mass-info">
          <div class="info-icon">ğŸ“¢</div>
          <div class="info-text"><b>Sin nombre del cliente.</b> Estos mensajes usan "Hola, buenas tardes" en lugar de un nombre especifico. Ideales para lanzar a listas de 50-500 numeros a la vez.</div>
        </div>

        <div class="field">
          <label>Plan anterior del grupo</label>
          <select id="massPlan">
            <option value="">Seleccionar plan...</option>
            <optgroup label="Con Todo (Nextel/Iusacell)">
              <option value="Con Todo 399">Con Todo 399 â€” $434/mes â€” 2 GB</option>
              <option value="Con Todo 499">Con Todo 499 â€” $534/mes â€” 3 GB</option>
              <option value="Con Todo 549">Con Todo 549 â€” $584/mes â€” 5 GB</option>
              <option value="Con Todo 599">Con Todo 599 â€” $634/mes â€” 6 GB</option>
              <option value="Con Todo 699">Con Todo 699 â€” $744/mes â€” 6 GB</option>
              <option value="Con Todo 799">Con Todo 799 â€” $844/mes â€” 8 GB</option>
              <option value="Con Todo 999">Con Todo 999 â€” $1,044/mes â€” 10 GB</option>
            </optgroup>
            <optgroup label="Consiguelo">
              <option value="Consiguelo 2">Consiguelo 2 â€” $404/mes â€” 2 GB</option>
              <option value="Consiguelo 3">Consiguelo 3 â€” $541/mes â€” 3 GB</option>
              <option value="Consiguelo 5">Consiguelo 5 â€” $667/mes â€” 5 GB</option>
              <option value="Consiguelo 6.5">Consiguelo 6.5 â€” $772/mes â€” 6.5 GB</option>
              <option value="Consiguelo 8">Consiguelo 8 â€” $887/mes â€” 8 GB</option>
              <option value="Consiguelo 10">Consiguelo 10 â€” $992/mes â€” 10 GB</option>
              <option value="Consiguelo 13">Consiguelo 13 â€” $1,202/mes â€” 13 GB</option>
              <option value="Consiguelo 20">Consiguelo 20 â€” $1,853/mes â€” 20 GB</option>
            </optgroup>
            <optgroup label="Armalo">
              <option value="Armalo 5">Armalo 5 â€” $419/mes â€” 5 GB</option>
              <option value="Armalo 8">Armalo 8 â€” $524/mes â€” 8 GB</option>
              <option value="Armalo 9">Armalo 9 â€” $629/mes â€” 9 GB</option>
              <option value="Armalo 10">Armalo 10 â€” $629/mes â€” 10 GB</option>
              <option value="Armalo 11">Armalo 11 â€” $681/mes â€” 11 GB</option>
              <option value="Armalo 12">Armalo 12 â€” $681/mes â€” 12 GB</option>
              <option value="Armalo 14">Armalo 14 â€” $786/mes â€” 14 GB</option>
              <option value="Armalo 17">Armalo 17 â€” $891/mes â€” 17 GB</option>
              <option value="Armalo 20">Armalo 20 â€” $996/mes â€” 20 GB</option>
              <option value="Armalo 26">Armalo 26 â€” $1,101/mes â€” 26 GB</option>
              <option value="Armalo 40">Armalo 40 â€” $1,574/mes â€” 40 GB</option>
            </optgroup>
          </select>
        </div>
        <div class="field">
          <label>Plan Premium a ofrecer</label>
          <select id="massPremium">
            <option value="auto">ğŸ¤– Automatico (mejor opcion)</option>
            <option value="AT&T Azul 2">AT&T Azul 2 â€” $419/mes â€” 8 GB</option>
            <option value="AT&T Azul 3">AT&T Azul 3 â€” $529/mes â€” 12 GB</option>
            <option value="AT&T Plata">AT&T Plata â€” $629/mes â€” 25 GB</option>
            <option value="AT&T Oro">AT&T Oro â€” $699/mes â€” 40 GB</option>
            <option value="AT&T Black">AT&T Black â€” $799/mes â€” 45 GB</option>
            <option value="AT&T Platino">AT&T Platino â€” $999/mes â€” 50 GB</option>
            <option value="AT&T Diamante">AT&T Diamante â€” $1,259/mes â€” 50 GB</option>
          </select>
          <div id="mass-premium-hint" style="font-size:10px;color:var(--text4);margin-top:4px"></div>
        </div>

        <div class="scenario-label" style="font-size:11px;font-weight:600;color:var(--text3);letter-spacing:.5px;text-transform:uppercase;margin-bottom:8px;margin-top:16px">Tipo de mensaje masivo</div>
        <button class="mass-scenario-btn active" data-mass-scenario="captacion" onclick="selectMassScenario(this)">
          <span class="emoji">ğŸ‘‹</span> Captacion (primer contacto) <span class="count" style="margin-left:auto;font-size:10px;color:var(--text4);background:rgba(100,116,139,0.15);padding:2px 7px;border-radius:10px">4 msgs</span>
        </button>
        <button class="mass-scenario-btn" data-mass-scenario="seguimiento" onclick="selectMassScenario(this)">
          <span class="emoji">ğŸ”„</span> Seguimiento (2do intento) <span class="count" style="margin-left:auto;font-size:10px;color:var(--text4);background:rgba(100,116,139,0.15);padding:2px 7px;border-radius:10px">4 msgs</span>
        </button>
        <button class="mass-scenario-btn" data-mass-scenario="urgencia" onclick="selectMassScenario(this)">
          <span class="emoji">ğŸ”¥</span> Urgencia / ultima oportunidad <span class="count" style="margin-left:auto;font-size:10px;color:var(--text4);background:rgba(100,116,139,0.15);padding:2px 7px;border-radius:10px">4 msgs</span>
        </button>
        <button class="mass-scenario-btn" data-mass-scenario="beneficios" onclick="selectMassScenario(this)">
          <span class="emoji">â­</span> Solo beneficios (sin precio) <span class="count" style="margin-left:auto;font-size:10px;color:var(--text4);background:rgba(100,116,139,0.15);padding:2px 7px;border-radius:10px">4 msgs</span>
        </button>

        <button class="btn-generate" onclick="generateMassMessages()" style="background:linear-gradient(135deg,#8B5CF6,#6D28D9)">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
          Generar Mensaje Masivo
        </button>
      </div>

      <!-- Mass Results -->
      <div class="results" id="mass-results">
        <div class="results-empty">
          <div class="icon" style="background:rgba(139,92,246,0.08)">
            <svg viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" style="stroke:var(--purple)"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
          </div>
          <h3>Mensajes para envio masivo</h3>
          <p>Selecciona el plan del grupo de clientes, elige el tipo de mensaje y genera. Mensajes sin nombre, listos para lanzar a toda una lista.</p>
        </div>
      </div>
    </div>
  </div><!-- end tab-masivo -->

</div>

<!-- Toast -->
<div class="toast" id="toast">
  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M20 6L9 17l-5-5"/></svg>
  Mensaje copiado al portapapeles
</div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PLAN DATABASE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const PLANS = {
  "Con Todo 399": {renta:434,gb:2,type:"contodo",benefits:"Llamadas, mensajes y redes sociales ilimitadas"},
  "Con Todo 499": {renta:534,gb:3,type:"contodo",benefits:"Llamadas, mensajes y redes sociales ilimitadas"},
  "Con Todo 549": {renta:584,gb:5,type:"contodo",benefits:"Llamadas, mensajes y redes sociales ilimitadas"},
  "Con Todo 599": {renta:634,gb:6,type:"contodo",benefits:"Llamadas, mensajes y redes sociales ilimitadas"},
  "Con Todo 699": {renta:744,gb:6,type:"contodo",benefits:"Llamadas, mensajes y redes sociales ilimitadas"},
  "Con Todo 799": {renta:844,gb:8,type:"contodo",benefits:"Llamadas, mensajes y redes sociales ilimitadas"},
  "Con Todo 999": {renta:1044,gb:10,type:"contodo",benefits:"Llamadas, mensajes y redes sociales ilimitadas"},
  "Consiguelo 2": {renta:404,gb:2,type:"consiguelo",benefits:"Apps ilimitadas + streaming + llamadas"},
  "Consiguelo 3": {renta:541,gb:3,type:"consiguelo",benefits:"Apps ilimitadas + streaming + llamadas"},
  "Consiguelo 5": {renta:667,gb:5,type:"consiguelo",benefits:"Apps ilimitadas + streaming + llamadas"},
  "Consiguelo 6.5":{renta:772,gb:6.5,type:"consiguelo",benefits:"Apps ilimitadas + streaming + llamadas"},
  "Consiguelo 8": {renta:887,gb:8,type:"consiguelo",benefits:"Apps ilimitadas + streaming + llamadas"},
  "Consiguelo 10": {renta:992,gb:10,type:"consiguelo",benefits:"Apps ilimitadas + streaming + llamadas"},
  "Consiguelo 13": {renta:1202,gb:13,type:"consiguelo",benefits:"Apps ilimitadas + streaming + llamadas"},
  "Consiguelo 20": {renta:1853,gb:20,type:"consiguelo",benefits:"Apps ilimitadas + streaming + llamadas"},
  "Armalo 5":  {renta:419,gb:5,type:"armalo",benefits:"Llamadas, mensajes y redes sociales ilimitadas"},
  "Armalo 8":  {renta:524,gb:8,type:"armalo",benefits:"Llamadas, mensajes y redes sociales ilimitadas"},
  "Armalo 9":  {renta:629,gb:9,type:"armalo",benefits:"Llamadas, mensajes y redes sociales ilimitadas"},
  "Armalo 10": {renta:629,gb:10,type:"armalo",benefits:"Llamadas, mensajes y redes sociales ilimitadas"},
  "Armalo 11": {renta:681,gb:11,type:"armalo",benefits:"Llamadas, mensajes y redes sociales ilimitadas"},
  "Armalo 12": {renta:681,gb:12,type:"armalo",benefits:"Llamadas, mensajes y redes sociales ilimitadas"},
  "Armalo 14": {renta:786,gb:14,type:"armalo",benefits:"Llamadas, mensajes y redes sociales ilimitadas"},
  "Armalo 17": {renta:891,gb:17,type:"armalo",benefits:"Llamadas, mensajes y redes sociales ilimitadas"},
  "Armalo 20": {renta:996,gb:20,type:"armalo",benefits:"Llamadas, mensajes y redes sociales ilimitadas"},
  "Armalo 26": {renta:1101,gb:26,type:"armalo",benefits:"Llamadas, mensajes y redes sociales ilimitadas"},
  "Armalo 40": {renta:1574,gb:40,type:"armalo",benefits:"Llamadas, mensajes y redes sociales ilimitadas"},
};

const PREMIUM = {
  "AT&T Azul 2": {renta:419,gb:8,benefits:"6 apps ilimitadas, 8 GB navegacion libre, llamadas y mensajes ilimitados a Mexico, EUA y Canada"},
  "AT&T Azul 3": {renta:529,gb:12,benefits:"6 apps ilimitadas, 12 GB navegacion libre, llamadas y mensajes ilimitados a Mexico, EUA y Canada"},
  "AT&T Plata":  {renta:629,gb:25,benefits:"6 apps ilimitadas, 25 GB navegacion libre, llamadas y mensajes ilimitados a Mexico, EUA y Canada"},
  "AT&T Oro":    {renta:699,gb:40,benefits:"6 apps ilimitadas, 40 GB navegacion libre, llamadas y mensajes ilimitados a Mexico, EUA y Canada"},
  "AT&T Black":  {renta:799,gb:45,benefits:"6 apps ilimitadas, 45 GB navegacion libre, llamadas y mensajes ilimitados a Mexico, EUA y Canada"},
  "AT&T Diamante":{renta:1259,gb:50,benefits:"6 apps ilimitadas, 50 GB navegacion libre, llamadas y mensajes ilimitados a Mexico, EUA y Canada"},
  "AT&T Platino": {renta:999,gb:50,benefits:"6 apps ilimitadas, 50 GB navegacion libre, llamadas y mensajes ilimitados a Mexico, EUA y Canada"},
};

function findBestPremium(renta, gb) {
  // First try: find plans that give MORE gb AND cost same or less
  let candidates = [];
  for (const [name, p] of Object.entries(PREMIUM)) {
    if (p.gb > gb) {
      const saving = renta - p.renta;
      const gbGain = p.gb - gb;
      candidates.push({ name, ...p, saving, gbGain, gbMultiple: (p.gb / gb).toFixed(1) });
    }
  }

  // Sort: prefer plans that save money AND give more data
  // Priority: 1) saves money or costs similar, 2) most GB gain
  if (candidates.length > 0) {
    candidates.sort((a, b) => {
      // Both save money or both cost more
      const aSaves = a.saving >= -50; // within $50 tolerance
      const bSaves = b.saving >= -50;
      if (aSaves && !bSaves) return -1;
      if (!aSaves && bSaves) return 1;
      // Among affordable ones, pick the best value (saving + gb gain)
      const aScore = a.saving * 1.5 + a.gbGain * 5;
      const bScore = b.saving * 1.5 + b.gbGain * 5;
      return bScore - aScore;
    });
    return candidates[0];
  }

  // Fallback: closest in price even if fewer GB (shouldn't happen often)
  let closest = null; let closestDiff = Infinity;
  for (const [name, p] of Object.entries(PREMIUM)) {
    const diff = Math.abs(p.renta - renta);
    if (diff < closestDiff) { closestDiff = diff; closest = { name, ...p, saving: renta - p.renta, gbGain: p.gb - gb, gbMultiple: (p.gb / Math.max(gb, 1)).toFixed(1) }; }
  }
  return closest;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// STATE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let selectedScenario = 'primer_contacto';

function selectScenario(btn) {
  document.querySelectorAll('.scenario-btn').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
  selectedScenario = btn.dataset.scenario;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MESSAGE TEMPLATES
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function getMessages(data) {
  const { name, agent, planName, planType, renta, gb, premium } = data;
  const pName = premium.name;
  const pRenta = premium.renta;
  const pGb = premium.gb;
  const saving = premium.saving;
  const gbMult = premium.gbMultiple;
  const savingYear = Math.abs(saving) * 12;
  const savesOrPaysMore = saving > 0;
  const rentaDiff = savesOrPaysMore ? `$${saving} menos al mes` : saving === 0 ? 'lo mismo' : `solo $${Math.abs(saving)} mas al mes`;
  const firstName = name.split(' ')[0];

  const templates = {
    primer_contacto: {
      tip: `<b>Tip:</b> El primer contacto debe ser corto y generar curiosidad. No satures con informacion. El objetivo es que responda "si" para poder llamarle.`,
      messages: [
        {
          tag: 'Opcion A â€” Directo con comparacion',
          text: `Hola ${firstName}, buenas tardes ğŸ‘‹ Te saluda ${agent} de AT&T.

Revisando tu linea veo que sigues con un plan ${planName} y hoy pagas $${renta}/mes por ${gb} GB.

Tengo una buena noticia: ya puedes actualizar a *${pName}* ${savesOrPaysMore ? `pagando *${rentaDiff}*` : saving === 0 ? 'pagando *lo mismo*' : `por *${rentaDiff}*`} y recibes:

âœ… *${pGb} GB* de navegacion (${gbMult}x mas que hoy)
âœ… 6 apps ilimitadas
âœ… Llamadas y mensajes a EUA y Canada

Conservas tu mismo numero y no tienes que ir a ninguna tienda. Te interesa? Solo toma 5 minutos ğŸ“²`
        },
        {
          tag: 'Opcion B â€” Corto y con gancho',
          text: `Hola ${firstName} ğŸ‘‹ Te contacto de AT&T.

${savesOrPaysMore
  ? `Sabias que hoy estas pagando *$${renta}/mes* y podrias pagar *$${pRenta}/mes* con ${gbMult}x mas datos y apps ilimitadas?`
  : `Sabias que por ${saving === 0 ? 'lo mismo que pagas hoy' : `solo $${Math.abs(saving)} mas`} podrias tener *${pGb} GB* en lugar de ${gb} GB mas apps ilimitadas y llamadas a EUA y Canada?`}

Tu plan ${planName} ya puede actualizarse y la mejora es importante.

Quieres que te explique en 2 minutos? ğŸ“±`
        },
        {
          tag: 'Opcion C â€” Interactivo con opciones',
          text: `Hola ${firstName}!ğŸ‘‹
Tu plan *${planName}* ya cumplio su vigencia y tienes disponible una actualizacion a los planes *Premium*ğŸ’
La diferencia principal es que con la actualizacion:
-Recibiras *${pGb} GB* (${gbMult}x mas de lo que tienes hoy)
-Tu tarifa ${savesOrPaysMore ? `bajara a tan solo *$${pRenta} al mes*` : saving === 0 ? `se mantiene en *$${pRenta} al mes*` : `sera de *$${pRenta} al mes*`}
-Podras adquirir el equipo que desees con descuentos increibles o bien si no deseas gastar simplemente reclama el equipo sin costo que te pertenece como cliente
-Mas apps ilimitadas
-Llamadas y mensajes a EUA y Canada

Con esta propuesta AT&T quiere darte lo mejor y por ello tu respuesta es valiosa para mejorar, responde:
1)ğŸ’°Obviamente quiero pagar menosğŸ’°
2)ğŸ“±Me interesa cotizar un equipoğŸ“±
3)No deseo ser contactado por este medio`
        },
        {
          tag: 'Opcion D â€” Alerta con multiples opciones',
          text: `ğŸš¨Actualizacion importanteğŸš¨

Hola ${firstName}, es hora de actualizar tu plan ya que *tu tarifa ${savesOrPaysMore ? `bajo a tan solo $${pRenta}` : `sera de tan solo $${pRenta}`}* y ademas ${savesOrPaysMore ? 'incremento' : 'tendras'} a *${pGb} GB* libres para navegar. Adicional puedes elegir entre llevarte un dispositivo sin costo o bien elegir el equipo que gustes aprovechando nuestros descuentos en las mejores marcas.

ğŸ“¢â€¼ï¸ Tambien recuerda que puedes adquirir una linea adicional sin plazo establecido si asi lo requieres â€¼ï¸ğŸ“¢

Tu respuesta es importante para nosotros, elige un numero ğŸš¨
1)*Si quiero pagar menos*ğŸ’°ğŸ’°ğŸ’°
2)*Me gustaria cotizar ğŸ¤‘ un equipo*ğŸ“²
3)*Requiero una linea adicional*
4)*Quiero mas informacion* ğŸ¤©
5) Deseo que no me contacten por este medio

*AT&T cambia el juego* ğŸ˜‰`
        }
      ]
    },

    seguimiento: {
      tip: `<b>Tip:</b> Si no contesto el primer mensaje, cambia el enfoque. Genera urgencia o curiosidad con un dato diferente. No reenvies el mismo mensaje.`,
      messages: [
        {
          tag: 'Opcion A â€” Dato de impacto',
          text: `${firstName}, te escribi hace unos dias sobre la mejora de tu plan AT&T.

Solo para que lo tengas claro: con tu plan actual pagas *$${renta}/mes* por *${gb} GB*. Con la actualizacion tendrias *${pGb} GB* ${savesOrPaysMore ? `y *ahorras $${saving} al mes* ($${savingYear} al aÃ±o)` : `por practicamente el mismo precio`}.

La promocion sigue disponible, pero no por mucho tiempo â³

Te interesa? Respondeme y lo armamos rapido.`
        },
        {
          tag: 'Opcion B â€” Ultra breve',
          text: `${firstName} ğŸ‘‹ Tu mejora de plan AT&T sigue disponible.

De *${gb} GB* pasas a *${pGb} GB* ${savesOrPaysMore ? `y pagas *menos* ($${pRenta} en lugar de $${renta})` : `por ${saving === 0 ? 'el mismo precio' : `solo $${Math.abs(saving)} mas`}`}.

Respondeme *SI* y te explico en 1 minuto âœ…`
        },
        {
          tag: 'Opcion C â€” Interactivo con opciones',
          text: `Hola de nuevo ${firstName}!ğŸ‘‹
Te contactamos de AT&T porque tu plan *${planName}* tiene una actualizacion *Premium* disponibleğŸ’

Mira lo que incluye:
-*${pGb} GB* de navegacion (${gbMult}x mas que tu plan actual)
-Tarifa ${savesOrPaysMore ? `mas baja: *$${pRenta}/mes* (hoy pagas $${renta})` : `de *$${pRenta}/mes*`}
-Acceso a descuentos en equipos o equipo sin costo
-Apps ilimitadas + llamadas a EUA y Canada

No queremos que te quedes sin esta mejora, respondenos:
1)ğŸ’°Quiero pagar menos y mejorar mi planğŸ’°
2)ğŸ“±Me interesa cotizar un equipoğŸ“±
3)No deseo ser contactado por este medio`
        },
        {
          tag: 'Opcion D â€” Alerta con multiples opciones',
          text: `ğŸš¨Actualizacion importanteğŸš¨

${firstName}, te recordamos que tu plan *${planName}* ya tiene disponible una mejora: *tu tarifa ${savesOrPaysMore ? `bajo a tan solo $${pRenta}` : `sera de tan solo $${pRenta}`}* y ademas ${savesOrPaysMore ? 'incremento' : 'tendras'} a *${pGb} GB* libres para navegar. Adicional puedes elegir entre llevarte un dispositivo sin costo o bien elegir el equipo que gustes aprovechando nuestros descuentos en las mejores marcas.

ğŸ“¢â€¼ï¸ Tambien recuerda que puedes adquirir una linea adicional sin plazo establecido si asi lo requieres â€¼ï¸ğŸ“¢

Tu respuesta es importante para nosotros, elige un numero ğŸš¨
1)*Si quiero pagar menos*ğŸ’°ğŸ’°ğŸ’°
2)*Me gustaria cotizar ğŸ¤‘ un equipo*ğŸ“²
3)*Requiero una linea adicional*
4)*Quiero mas informacion* ğŸ¤©
5) Deseo que no me contacten por este medio

*AT&T cambia el juego* ğŸ˜‰`
        }
      ]
    },

    cierre: {
      tip: `<b>Tip:</b> El mensaje de cierre debe crear urgencia real. Usa fechas, numeros concretos y haz que la accion sea facil ("solo responde SI").`,
      messages: [
        {
          tag: 'Opcion A â€” Urgencia con fecha',
          text: `${firstName}, te comento que la promocion para actualizar tu plan ${planName} esta por vencer este mes.

Mira lo que pierdes si no actualizas:

âŒ Tu plan actual: ${gb} GB + solo redes sociales â€” *$${renta}/mes*
âœ… Plan ${pName}: *${pGb} GB* + 6 apps ilimitadas + llamadas a EUA/Canada â€” *$${pRenta}/mes*

${savesOrPaysMore ? `Son *$${savingYear} de ahorro al aÃ±o* ğŸ’°` : `Es ${gbMult}x mas datos por practicamente lo mismo`}

Despues de este mes, tu linea se queda con el plan anterior sin posibilidad de mejora en las mismas condiciones.

Lo activamos? Te llamo en 2 minutos si me respondes *SI* âœ…`
        },
        {
          tag: 'Opcion B â€” Social proof + facilidad',
          text: `${firstName}, esta semana ya ayudamos a muchos clientes AT&T con plan ${planType === 'contodo' ? 'Con Todo' : planType === 'consiguelo' ? 'Consiguelo' : 'Armalo'} a mejorar su servicio.

La mayoria paso de ${gb} GB a *${pGb} GB* ${savesOrPaysMore ? `ahorrando *$${saving}/mes*` : 'sin pagar mas'}.

Lo hacemos en 5 minutos por telefono, no tienes que ir a tienda ni hacer tramites complicados ğŸ™Œ

Te marco? Solo respondeme *SI* y listo.`
        },
        {
          tag: 'Opcion C â€” Interactivo con opciones',
          text: `âš ï¸ Ultima oportunidad ${firstName}!
Tu plan *${planName}* esta por perder la posibilidad de actualizar a *Premium*ğŸ’

Lo que esta en juego:
-Pasarias de *${gb} GB* a *${pGb} GB* de navegacion
${savesOrPaysMore ? `-Ahorrarias *$${saving}/mes* ($${savingYear} al aÃ±o)` : `-Tu tarifa seria de *$${pRenta}/mes*`}
-Descuentos exclusivos en equipos nuevos o equipo sin costo
-Apps ilimitadas + llamadas a EUA y Canada

Responde antes de que cierre:
1)ğŸ’°Si! Quiero la mejorağŸ’°
2)ğŸ“±Me interesa un equipo nuevoğŸ“±
3)No deseo ser contactado por este medio`
        },
        {
          tag: 'Opcion D â€” Alerta con multiples opciones',
          text: `ğŸš¨Actualizacion importante ${firstName}ğŸš¨

Tu plan *${planName}* esta en sus ultimos dias para actualizar. *Tu tarifa ${savesOrPaysMore ? `bajo a tan solo $${pRenta}` : `sera de tan solo $${pRenta}`}* y ademas ${savesOrPaysMore ? 'incremento' : 'tendras'} a *${pGb} GB* libres para navegar. Adicional puedes elegir entre llevarte un dispositivo sin costo o bien elegir el equipo que gustes aprovechando nuestros descuentos en las mejores marcas.

ğŸ“¢â€¼ï¸ Tambien recuerda que puedes adquirir una linea adicional sin plazo establecido si asi lo requieres â€¼ï¸ğŸ“¢

No dejes pasar esta oportunidad, elige un numero ğŸš¨
1)*Si quiero pagar menos*ğŸ’°ğŸ’°ğŸ’°
2)*Me gustaria cotizar ğŸ¤‘ un equipo*ğŸ“²
3)*Requiero una linea adicional*
4)*Quiero mas informacion* ğŸ¤©
5) Deseo que no me contacten por este medio

*AT&T cambia el juego* ğŸ˜‰`
        }
      ]
    },

    tienda: {
      tip: `<b>Tip:</b> El cliente que dice "prefiero ir a tienda" generalmente tiene desconfianza o quiere verlo en persona. Valida su preocupacion y muestra las ventajas de hacerlo por telefono.`,
      messages: [
        {
          tag: 'Opcion A â€” Validar + ventaja del telefono',
          text: `Entiendo perfectamente ${firstName} ğŸ‘ Es normal querer ir a la tienda.

Solo te comento 3 ventajas de hacerlo conmigo por telefono:

1ï¸âƒ£ *No haces fila* â€” en tienda el tiempo promedio es de 40 min a 1 hora
2ï¸âƒ£ *Mismo resultado* â€” el plan ${pName} con *${pGb} GB* a *$${pRenta}/mes* es exactamente el mismo
3ï¸âƒ£ *Queda grabado* â€” la llamada queda registrada como respaldo de tu cambio

Si prefieres ir a tienda no hay problema, pero si quieres ahorrarte el viaje lo hacemos ahorita en 5 minutos ğŸ“²

Tu decides ğŸ¤`
        },
        {
          tag: 'Opcion B â€” Disponibilidad + urgencia',
          text: `Claro ${firstName}, en la tienda te pueden atender sin problema.

Solo ten en cuenta que esta promocion la estamos manejando directamente y *puede que en tienda no tengan la misma oferta*.

Tu plan ${planName} de $${renta}/mes cambiaria a *${pName}* con *${pGb} GB* a *$${pRenta}/mes* ${savesOrPaysMore ? `(*ahorras $${saving}/mes*)` : ''}.

Si decides hacerlo por aqui, te llamo y lo resolvemos rapido. Si prefieres tienda, te recomiendo ir a la mas cercana antes de fin de mes cuando cambian las promociones.

Como le hacemos? ğŸ“±`
        },
        {
          tag: 'Opcion C â€” Interactivo con opciones',
          text: `Hola ${firstName}!ğŸ‘‹
Entendemos que prefieras ir a tienda, es totalmente valido ğŸ‘

Pero antes de que hagas el viaje, mira lo que tu plan *${planName}* puede mejorar:
-*${pGb} GB* de navegacion (${gbMult}x mas que hoy)
-Tarifa ${savesOrPaysMore ? `mas baja: *$${pRenta}/mes*` : `de *$${pRenta}/mes*`}
-Equipo sin costo o descuentos increibles
-Apps ilimitadas + llamadas a EUA y Canada

Todo esto lo puedes hacer por telefono en 5 minutos, sin filas. Pero tu decides:
1)ğŸ’°Hagamoslo por telefono, quiero la mejorağŸ’°
2)ğŸ“±Me interesa cotizar un equipoğŸ“±
3)Prefiero ir a tienda de todos modos`
        },
        {
          tag: 'Opcion D â€” Alerta con multiples opciones',
          text: `ğŸš¨Actualizacion importante ${firstName}ğŸš¨

Antes de que vayas a tienda, te compartimos que *tu tarifa ${savesOrPaysMore ? `bajo a tan solo $${pRenta}` : `sera de tan solo $${pRenta}`}* y ademas ${savesOrPaysMore ? 'incremento' : 'tendras'} a *${pGb} GB* libres para navegar. Adicional puedes elegir entre llevarte un dispositivo sin costo o bien elegir el equipo que gustes aprovechando nuestros descuentos en las mejores marcas.

ğŸ“¢â€¼ï¸ Tambien recuerda que puedes adquirir una linea adicional sin plazo establecido si asi lo requieres â€¼ï¸ğŸ“¢

Lo mejor: lo hacemos por telefono sin que tengas que hacer fila ğŸ™Œ

Elige un numero ğŸš¨
1)*Si quiero pagar menos*ğŸ’°ğŸ’°ğŸ’°
2)*Me gustaria cotizar ğŸ¤‘ un equipo*ğŸ“²
3)*Requiero una linea adicional*
4)*Quiero mas informacion* ğŸ¤©
5) Deseo que no me contacten por este medio

*AT&T cambia el juego* ğŸ˜‰`
        }
      ]
    }
  };

  return templates[selectedScenario];
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// GENERATE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function generateMessages() {
  try {
  const name = document.getElementById('clientName').value.trim();
  const planKey = document.getElementById('planAnterior').value;
  const rentaOverride = document.getElementById('rentaOverride').value.trim();
  const agent = document.getElementById('agentName').value.trim();
  const premiumChoice = document.getElementById('premiumPlan').value;

  if (!name) { shake('clientName'); return; }
  if (!planKey) { shake('planAnterior'); return; }

  const plan = PLANS[planKey];
  const renta = rentaOverride ? parseInt(rentaOverride.replace(/[^0-9]/g,'')) : plan.renta;

  let premium;
  if (premiumChoice === 'auto') {
    premium = findBestPremium(renta, plan.gb);
  } else {
    const p = PREMIUM[premiumChoice];
    premium = { name: premiumChoice, ...p, saving: renta - p.renta, gbGain: p.gb - plan.gb, gbMultiple: (p.gb / plan.gb).toFixed(1) };
  }

  const data = { name, agent: agent || 'tu asesor', planName: planKey, planType: plan.type, renta, gb: plan.gb, premium };
  const result = getMessages(data);

  renderResults(data, result);
  } catch(e) { alert('Error al generar: ' + e.message); console.error(e); }
}

// Auto-suggest premium when anterior plan changes
document.getElementById('planAnterior').addEventListener('change', function() {
  const planKey = this.value;
  if (!planKey) { document.getElementById('premium-hint').textContent = ''; return; }
  const plan = PLANS[planKey];
  const rentaOverride = document.getElementById('rentaOverride').value.trim();
  const renta = rentaOverride ? parseInt(rentaOverride.replace(/[^0-9]/g,'')) : plan.renta;
  const best = findBestPremium(renta, plan.gb);
  if (best) {
    document.getElementById('premium-hint').innerHTML = 'ğŸ’¡ Sugerencia: <b>' + best.name + '</b> ($' + best.renta + '/mes, ' + best.gb + ' GB) â€” ' + (best.saving > 0 ? 'ahorra $' + best.saving + '/mes' : best.saving === 0 ? 'mismo precio' : 'solo $' + Math.abs(best.saving) + ' mas');
    document.getElementById('premiumPlan').value = 'auto';
  }
});

function shake(id) {
  const el = document.getElementById(id);
  el.style.borderColor = '#EF4444';
  el.style.animation = 'shake .4s ease';
  setTimeout(() => { el.style.animation = ''; el.style.borderColor = ''; }, 500);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// RENDER
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderResults(data, result) {
  const { renta, gb, premium, planName } = data;
  const saving = premium.saving;
  const savesOrPaysMore = saving > 0;

  let html = '';

  // Comparison card
  html += `<div class="comparison">
    <div class="comparison-title">Comparativa automatica del plan</div>
    <div class="compare-grid">
      <div class="compare-box old">
        <div class="box-label">Plan Actual</div>
        <div class="plan-name">${planName}</div>
        <div class="plan-price">$${renta}</div>
        <div class="plan-data">${gb} GB + redes sociales</div>
      </div>
      <div class="compare-arrow">â†’</div>
      <div class="compare-box new">
        <div class="box-label">Plan Recomendado</div>
        <div class="plan-name">${premium.name}</div>
        <div class="plan-price">$${premium.renta}</div>
        <div class="plan-data">${premium.gb} GB + 6 apps + EUA/CAN</div>
      </div>
    </div>
    <div class="savings-strip">
      <div class="saving-item"><div class="val" style="color:${savesOrPaysMore?'#10B981':saving===0?'var(--att)':'#F59E0B'}">${savesOrPaysMore?'-$'+saving+'/mes':saving===0?'$0':'+ $'+Math.abs(saving)+'/mes'}</div><div class="lbl">${savesOrPaysMore?'Ahorro mensual':saving===0?'Mismo precio':'Diferencia'}</div></div>
      <div class="saving-item"><div class="val" style="color:#009FDB">${premium.gbMultiple}x</div><div class="lbl">Mas datos</div></div>
      <div class="saving-item"><div class="val" style="color:#10B981">${premium.gb} GB</div><div class="lbl">Navegacion libre</div></div>
      ${savesOrPaysMore?`<div class="saving-item"><div class="val" style="color:#10B981">$${saving*12}/aÃ±o</div><div class="lbl">Ahorro anual</div></div>`:''}
    </div>
  </div>`;

  // Tip
  html += `<div class="scenario-tip"><div class="tip-icon">ğŸ’¡</div><div class="tip-text">${result.tip}</div></div>`;

  // Message cards
  result.messages.forEach((msg, i) => {
    const tagClass = ['tag-a','tag-b','tag-c','tag-d'][i] || 'tag-a';
    const now = new Date();
    const timeStr = now.getHours().toString().padStart(2,'0') + ':' + now.getMinutes().toString().padStart(2,'0');

    html += `<div class="msg-card">
      <div class="msg-header">
        <span class="tag ${tagClass}">${msg.tag}</span>
        <button class="btn-copy" onclick="copyMessage(this, ${i})" data-msg-index="${i}">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>
          Copiar mensaje
        </button>
      </div>
      <div class="wa-bubble-container">
        <div class="wa-bubble">${msg.text}<div class="wa-time">${timeStr} âœ“âœ“</div></div>
      </div>
    </div>`;
  });

  document.getElementById('results').innerHTML = html;

  // Store messages for copy
  window._generatedMessages = result.messages.map(m => m.text);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// COPY (with fallback for HTTP / mobile)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function fallbackCopy(text) {
  var ta = document.createElement('textarea');
  ta.value = text;
  ta.style.position = 'fixed';
  ta.style.left = '-9999px';
  ta.style.top = '-9999px';
  document.body.appendChild(ta);
  ta.focus();
  ta.select();
  try { document.execCommand('copy'); } catch(e) {}
  document.body.removeChild(ta);
}

function doCopy(text) {
  if (navigator.clipboard && window.isSecureContext) {
    navigator.clipboard.writeText(text).catch(function() { fallbackCopy(text); });
  } else {
    fallbackCopy(text);
  }
}

function copyMessage(btn, idx) {
  try {
    var waText = window._generatedMessages[idx].replace(/\n{3,}/g, '\n\n');
    doCopy(waText);
    btn.classList.add('copied');
    btn.innerHTML = '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M20 6L9 17l-5-5"/></svg> Copiado!';
    showToast();
    setTimeout(function() {
      btn.classList.remove('copied');
      btn.innerHTML = '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg> Copiar mensaje';
    }, 2000);
  } catch(e) { alert('Error al copiar: ' + e.message); }
}

function showToast() {
  const toast = document.getElementById('toast');
  toast.classList.add('show');
  setTimeout(() => toast.classList.remove('show'), 2500);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TABS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function switchTab(tab) {
  document.querySelectorAll('.tab-btn').forEach((b, i) => b.classList.toggle('active', (tab === 'personal' && i === 0) || (tab === 'masivo' && i === 1)));
  document.getElementById('tab-personal').classList.toggle('active', tab === 'personal');
  document.getElementById('tab-masivo').classList.toggle('active', tab === 'masivo');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MASS MESSAGING
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let selectedMassScenario = 'captacion';

function selectMassScenario(btn) {
  document.querySelectorAll('.mass-scenario-btn').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
  selectedMassScenario = btn.dataset.massScenario;
}

document.getElementById('massPlan').addEventListener('change', function() {
  const planKey = this.value;
  if (!planKey) { document.getElementById('mass-premium-hint').textContent = ''; return; }
  const plan = PLANS[planKey];
  const best = findBestPremium(plan.renta, plan.gb);
  if (best) {
    document.getElementById('mass-premium-hint').innerHTML = 'ğŸ’¡ Sugerencia: <b>' + best.name + '</b> ($' + best.renta + '/mes, ' + best.gb + ' GB) â€” ' + (best.saving > 0 ? 'ahorra $' + best.saving + '/mes' : best.saving === 0 ? 'mismo precio' : 'solo $' + Math.abs(best.saving) + ' mas');
  }
});

function generateMassMessages() {
  try {
  const planKey = document.getElementById('massPlan').value;
  const premiumChoice = document.getElementById('massPremium').value;

  if (!planKey) { shake('massPlan'); return; }

  const plan = PLANS[planKey];
  const renta = plan.renta;
  const gb = plan.gb;

  let premium;
  if (premiumChoice === 'auto') {
    premium = findBestPremium(renta, gb);
  } else {
    const p = PREMIUM[premiumChoice];
    premium = { name: premiumChoice, ...p, saving: renta - p.renta, gbGain: p.gb - gb, gbMultiple: (p.gb / Math.max(gb, 1)).toFixed(1) };
  }

  const pName = premium.name;
  const pRenta = premium.renta;
  const pGb = premium.gb;
  const saving = premium.saving;
  const savingYear = Math.abs(saving) * 12;
  const gbMult = premium.gbMultiple;
  const savesOrPaysMore = saving > 0;
  const planType = plan.type === 'contodo' ? 'Con Todo' : plan.type === 'consiguelo' ? 'Consiguelo' : 'Armalo';

  const templates = {
    captacion: {
      tip: `<b>Captacion masiva:</b> Mensajes cortos y directos. El objetivo es que respondan "si". No incluyen nombre porque van a listas completas.`,
      messages: [
        {
          tag: 'Opcion A â€” Con datos duros',
          text: `Hola, buenas tardes ğŸ‘‹ Te contactamos de AT&T.

Detectamos que tu plan *${planKey}* ya puede actualizarse.

Hoy pagas *$${renta}/mes* por *${gb} GB*. Con la actualizacion a *${pName}* ${savesOrPaysMore ? 'pagarias *$' + pRenta + '/mes* (*$' + saving + ' menos*)' : saving === 0 ? 'pagarias *lo mismo*' : 'pagarias *$' + pRenta + '/mes*'} y recibes:

âœ… *${pGb} GB* de navegacion (${gbMult}x mas)
âœ… 6 apps ilimitadas
âœ… Llamadas a EUA y Canada

Conservas tu numero, sin ir a tienda. Te interesa? ğŸ“²`
        },
        {
          tag: 'Opcion B â€” Corto y curioso',
          text: `Hola ğŸ‘‹ Te escribimos de AT&T.

${savesOrPaysMore
  ? `Sabias que hoy pagas *$${renta}* por tu plan y podrias pagar *$${pRenta}* con *${pGb} GB* y apps ilimitadas?`
  : `Sabias que por ${saving === 0 ? 'lo que ya pagas' : 'casi lo mismo'} podrias tener *${pGb} GB* en lugar de *${gb} GB* mas apps ilimitadas y llamadas a EUA y Canada?`}

Tu plan ${planKey} ya tiene actualizacion disponible âœ…

Quieres saber mas? Respondeme SI y te explico en 2 minutos.`
        },
        {
          tag: 'Opcion C â€” Interactivo con opciones',
          text: `Hola!ğŸ‘‹
Tu plan *${planKey}* ya cumplio su vigencia y tienes disponible una actualizacion a los planes *Premium*ğŸ’
La diferencia principal es que con la actualizacion:
-Recibiras *${pGb} GB* (${gbMult}x mas de lo que tienes hoy)
-Tu tarifa ${savesOrPaysMore ? `bajara a tan solo *$${pRenta} al mes*` : saving === 0 ? `se mantiene en *$${pRenta} al mes*` : `sera de *$${pRenta} al mes*`}
-Podras adquirir el equipo que desees con descuentos increibles o bien si no deseas gastar simplemente reclama el equipo sin costo que te pertenece como cliente
-Mas apps ilimitadas
-Llamadas y mensajes a EUA y Canada

Con esta propuesta AT&T quiere darte lo mejor y por ello tu respuesta es valiosa para mejorar, responde:
1)ğŸ’°Obviamente quiero pagar menosğŸ’°
2)ğŸ“±Me interesa cotizar un equipoğŸ“±
3)No deseo ser contactado por este medio`
        },
        {
          tag: 'Opcion D â€” Alerta con multiples opciones',
          text: `ğŸš¨Actualizacion importanteğŸš¨

Es hora de actualizar tu plan ya que *tu tarifa ${savesOrPaysMore ? `bajo a tan solo $${pRenta}` : `sera de tan solo $${pRenta}`}* y ademas ${savesOrPaysMore ? 'incremento' : 'tendras'} a *${pGb} GB* libres para navegar. Adicional puedes elegir entre llevarte un dispositivo sin costo o bien elegir el equipo que gustes aprovechando nuestros descuentos en las mejores marcas.

ğŸ“¢â€¼ï¸ Tambien recuerda que puedes adquirir una linea adicional sin plazo establecido si asi lo requieres â€¼ï¸ğŸ“¢

Tu respuesta es importante para nosotros, elige un numero ğŸš¨
1)*Si quiero pagar menos*ğŸ’°ğŸ’°ğŸ’°
2)*Me gustaria cotizar ğŸ¤‘ un equipo*ğŸ“²
3)*Requiero una linea adicional*
4)*Quiero mas informacion* ğŸ¤©
5) Deseo que no me contacten por este medio

*AT&T cambia el juego* ğŸ˜‰`
        }
      ]
    },

    seguimiento: {
      tip: `<b>Seguimiento masivo:</b> Para listas que ya recibieron un primer mensaje y no contestaron. Cambia el angulo y genera urgencia.`,
      messages: [
        {
          tag: 'Opcion A â€” Recordatorio con dato',
          text: `Hola, te escribimos hace unos dias de AT&T sobre la mejora disponible para tu plan ğŸ“±

Solo para recordarte: con tu plan *${planKey}* pagas *$${renta}/mes* por *${gb} GB*.

Con la actualizacion tendrias *${pGb} GB* ${savesOrPaysMore ? `y *ahorras $${saving} al mes* ($${savingYear} al aÃ±o ğŸ’°)` : `por ${saving === 0 ? 'el mismo precio' : 'practicamente lo mismo'}`}.

La oferta sigue vigente pero tiene fecha limite â³

Respondeme SI si te interesa.`
        },
        {
          tag: 'Opcion B â€” Muy breve',
          text: `ğŸ‘‹ Tu mejora de plan AT&T sigue disponible.

De *${gb} GB* a *${pGb} GB* ${savesOrPaysMore ? `pagando *menos* ($${pRenta} en vez de $${renta})` : `por ${saving === 0 ? 'el mismo precio' : 'casi lo mismo'}`}.

Responde *SI* y te explico rapido âœ…`
        },
        {
          tag: 'Opcion C â€” Interactivo con opciones',
          text: `Hola de nuevo!ğŸ‘‹
Te contactamos de AT&T porque tu plan *${planKey}* tiene una actualizacion *Premium* disponibleğŸ’

Mira lo que incluye:
-*${pGb} GB* de navegacion (${gbMult}x mas que tu plan actual)
-Tarifa ${savesOrPaysMore ? `mas baja: *$${pRenta}/mes* (hoy pagas $${renta})` : `de *$${pRenta}/mes*`}
-Acceso a descuentos en equipos o equipo sin costo
-Apps ilimitadas + llamadas a EUA y Canada

No queremos que te quedes sin esta mejora, respondenos:
1)ğŸ’°Quiero pagar menos y mejorar mi planğŸ’°
2)ğŸ“±Me interesa cotizar un equipoğŸ“±
3)No deseo ser contactado por este medio`
        },
        {
          tag: 'Opcion D â€” Alerta con multiples opciones',
          text: `ğŸš¨Actualizacion importanteğŸš¨

Te recordamos que tu plan *${planKey}* ya tiene disponible una mejora: *tu tarifa ${savesOrPaysMore ? `bajo a tan solo $${pRenta}` : `sera de tan solo $${pRenta}`}* y ademas ${savesOrPaysMore ? 'incremento' : 'tendras'} a *${pGb} GB* libres para navegar. Adicional puedes elegir entre llevarte un dispositivo sin costo o bien elegir el equipo que gustes aprovechando nuestros descuentos en las mejores marcas.

ğŸ“¢â€¼ï¸ Tambien recuerda que puedes adquirir una linea adicional sin plazo establecido si asi lo requieres â€¼ï¸ğŸ“¢

Tu respuesta es importante para nosotros, elige un numero ğŸš¨
1)*Si quiero pagar menos*ğŸ’°ğŸ’°ğŸ’°
2)*Me gustaria cotizar ğŸ¤‘ un equipo*ğŸ“²
3)*Requiero una linea adicional*
4)*Quiero mas informacion* ğŸ¤©
5) Deseo que no me contacten por este medio

*AT&T cambia el juego* ğŸ˜‰`
        }
      ]
    },

    urgencia: {
      tip: `<b>Urgencia:</b> Ultimo intento. Usa escasez y datos concretos para motivar la accion inmediata.`,
      messages: [
        {
          tag: 'Opcion A â€” Ultimo aviso con comparacion',
          text: `âš ï¸ Ultimo aviso sobre tu actualizacion AT&T.

Tu plan *${planKey}* ya puede migrar a *${pName}* con mejores beneficios:

âŒ Hoy: *${gb} GB* + redes sociales â€” *$${renta}/mes*
âœ… Nuevo: *${pGb} GB* + 6 apps ilimitadas + EUA/Canada â€” *$${pRenta}/mes*

${savesOrPaysMore ? `Son *$${savingYear} de ahorro al aÃ±o*.` : `${gbMult}x mas datos por ${saving === 0 ? 'el mismo precio' : 'casi lo mismo'}.`}

Esta promocion vence pronto. Despues tu linea se queda sin posibilidad de mejora en estas condiciones.

Responde *SI* para activarlo hoy âœ…`
        },
        {
          tag: 'Opcion B â€” Social proof breve',
          text: `Esta semana cientos de clientes AT&T con plan *${planType}* ya actualizaron su servicio ğŸš€

Pasaron de *${gb} GB* a *${pGb} GB* ${savesOrPaysMore ? `ahorrando *$${saving}/mes*` : 'sin pagar mas'}.

No te quedes con el plan anterior. Responde *SI* y lo activamos en 5 minutos. Sin ir a tienda ğŸ™Œ`
        },
        {
          tag: 'Opcion C â€” Interactivo con opciones',
          text: `âš ï¸ Ultima oportunidad!
Tu plan *${planKey}* esta por perder la posibilidad de actualizar a *Premium*ğŸ’

Lo que esta en juego:
-Pasarias de *${gb} GB* a *${pGb} GB* de navegacion
${savesOrPaysMore ? `-Ahorrarias *$${saving}/mes* ($${savingYear} al aÃ±o)` : `-Tu tarifa seria de *$${pRenta}/mes*`}
-Descuentos exclusivos en equipos nuevos o equipo sin costo
-Apps ilimitadas + llamadas a EUA y Canada

Esta oferta vence pronto y no podremos garantizar las mismas condiciones despues.

Responde antes de que cierre:
1)ğŸ’°Si! Quiero la mejorağŸ’°
2)ğŸ“±Me interesa un equipo nuevoğŸ“±
3)No deseo ser contactado por este medio`
        },
        {
          tag: 'Opcion D â€” Alerta con multiples opciones',
          text: `ğŸš¨Actualizacion importante â€” Ultimo avisoğŸš¨

Tu plan *${planKey}* esta en sus ultimos dias para actualizar. *Tu tarifa ${savesOrPaysMore ? `bajo a tan solo $${pRenta}` : `sera de tan solo $${pRenta}`}* y ademas ${savesOrPaysMore ? 'incremento' : 'tendras'} a *${pGb} GB* libres para navegar. Adicional puedes elegir entre llevarte un dispositivo sin costo o bien elegir el equipo que gustes aprovechando nuestros descuentos en las mejores marcas.

ğŸ“¢â€¼ï¸ Tambien recuerda que puedes adquirir una linea adicional sin plazo establecido si asi lo requieres â€¼ï¸ğŸ“¢

No dejes pasar esta oportunidad, elige un numero ğŸš¨
1)*Si quiero pagar menos*ğŸ’°ğŸ’°ğŸ’°
2)*Me gustaria cotizar ğŸ¤‘ un equipo*ğŸ“²
3)*Requiero una linea adicional*
4)*Quiero mas informacion* ğŸ¤©
5) Deseo que no me contacten por este medio

*AT&T cambia el juego* ğŸ˜‰`
        }
      ]
    },

    beneficios: {
      tip: `<b>Solo beneficios:</b> No menciona precios. Util cuando no quieres que el precio sea el foco o cuando el ahorro es minimo. Enfocate en lo que gana.`,
      messages: [
        {
          tag: 'Opcion A â€” Enfocado en mejoras',
          text: `Hola ğŸ‘‹ Te contactamos de AT&T con buenas noticias.

Tu plan *${planKey}* ya tiene disponible una actualizacion con mejores beneficios:

âœ… Mas gigas de navegacion libre
âœ… 6 apps completamente ilimitadas (WhatsApp, Facebook, Instagram, TikTok y mas)
âœ… Llamadas y mensajes ilimitados a Mexico, EUA y Canada
âœ… Conservas tu mismo numero

Todo sin ir a tienda y en menos de 5 minutos ğŸ“²

Te gustaria conocer los detalles? Responde SI y te explico.`
        },
        {
          tag: 'Opcion B â€” Pregunta gancho',
          text: `Hola ğŸ‘‹ Pregunta rapida:

Tu plan AT&T actual tiene llamadas a Estados Unidos y Canada? Y apps de streaming ilimitadas?

Si la respuesta es no, tu plan ya puede actualizarse a uno que SI incluye todo eso âœ…

Quieres que te cuente como funciona? Solo toma 2 minutos.`
        },
        {
          tag: 'Opcion C â€” Interactivo con opciones',
          text: `Hola!ğŸ‘‹
Tenemos noticias para ti de parte de AT&TğŸ’

Tu plan *${planKey}* ya puede actualizarse a un plan *Premium* con beneficios superiores:
-*${pGb} GB* de navegacion libre
-6 apps completamente ilimitadas
-Llamadas y mensajes a Mexico, EUA y Canada
-Acceso a descuentos increibles en equipos o reclama tu equipo sin costo como cliente

AT&T quiere darte lo mejor y por ello tu respuesta es valiosa para mejorar, responde:
1)ğŸ’°Me interesa mejorar mi planğŸ’°
2)ğŸ“±Quiero cotizar un equipoğŸ“±
3)No deseo ser contactado por este medio`
        },
        {
          tag: 'Opcion D â€” Alerta con multiples opciones',
          text: `ğŸš¨Actualizacion importanteğŸš¨

Es hora de actualizar tu plan ya que *tu tarifa ${savesOrPaysMore ? `bajo a tan solo $${pRenta}` : `sera de tan solo $${pRenta}`}* y ademas ${savesOrPaysMore ? 'incremento' : 'tendras'} a *${pGb} GB* libres para navegar. Adicional puedes elegir entre llevarte un dispositivo sin costo o bien elegir el equipo que gustes aprovechando nuestros descuentos en las mejores marcas.

ğŸ“¢â€¼ï¸ Tambien recuerda que puedes adquirir una linea adicional sin plazo establecido si asi lo requieres â€¼ï¸ğŸ“¢

Tu respuesta es importante para nosotros, elige un numero ğŸš¨
1)*Si quiero pagar menos*ğŸ’°ğŸ’°ğŸ’°
2)*Me gustaria cotizar ğŸ¤‘ un equipo*ğŸ“²
3)*Requiero una linea adicional*
4)*Quiero mas informacion* ğŸ¤©
5) Deseo que no me contacten por este medio

*AT&T cambia el juego* ğŸ˜‰`
        }
      ]
    }
  };

  const result = templates[selectedMassScenario];
  renderMassResults(planKey, renta, gb, premium, result);
  } catch(e) { alert('Error al generar masivo: ' + e.message); console.error(e); }
}

function renderMassResults(planName, renta, gb, premium, result) {
  const saving = premium.saving;
  const savesOrPaysMore = saving > 0;

  let html = '';

  // Comparison
  html += `<div class="comparison">
    <div class="comparison-title">Comparativa del grupo: ${planName}</div>
    <div class="compare-grid">
      <div class="compare-box old">
        <div class="box-label">Plan Actual</div>
        <div class="plan-name">${planName}</div>
        <div class="plan-price">$${renta}</div>
        <div class="plan-data">${gb} GB + redes sociales</div>
      </div>
      <div class="compare-arrow">â†’</div>
      <div class="compare-box new">
        <div class="box-label">Plan Premium</div>
        <div class="plan-name">${premium.name}</div>
        <div class="plan-price">$${premium.renta}</div>
        <div class="plan-data">${premium.gb} GB + 6 apps + EUA/CAN</div>
      </div>
    </div>
    <div class="savings-strip">
      <div class="saving-item"><div class="val" style="color:${savesOrPaysMore?'#10B981':saving===0?'var(--att)':'#F59E0B'}">${savesOrPaysMore?'-$'+saving+'/mes':saving===0?'$0':'+$'+Math.abs(saving)+'/mes'}</div><div class="lbl">${savesOrPaysMore?'Ahorro mensual':saving===0?'Mismo precio':'Diferencia'}</div></div>
      <div class="saving-item"><div class="val" style="color:#009FDB">${premium.gbMultiple}x</div><div class="lbl">Mas datos</div></div>
      <div class="saving-item"><div class="val" style="color:#10B981">${premium.gb} GB</div><div class="lbl">Navegacion libre</div></div>
      ${savesOrPaysMore?`<div class="saving-item"><div class="val" style="color:#10B981">$${saving*12}/aÃ±o</div><div class="lbl">Ahorro anual</div></div>`:''}
    </div>
  </div>`;

  // Tip
  html += `<div class="scenario-tip"><div class="tip-icon">ğŸ’¡</div><div class="tip-text">${result.tip}</div></div>`;

  // Messages
  result.messages.forEach((msg, i) => {
    const tagClass = ['tag-a','tag-b','tag-c','tag-d'][i] || 'tag-a';
    const now = new Date();
    const timeStr = now.getHours().toString().padStart(2,'0') + ':' + now.getMinutes().toString().padStart(2,'0');
    html += `<div class="msg-card">
      <div class="msg-header">
        <span class="tag ${tagClass}">${msg.tag}</span>
        <button class="btn-copy" onclick="copyMassMessage(this, ${i})">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>
          Copiar mensaje
        </button>
      </div>
      <div class="wa-bubble-container">
        <div class="wa-bubble">${msg.text}<div class="wa-time">${timeStr} âœ“âœ“</div></div>
      </div>
    </div>`;
  });

  document.getElementById('mass-results').innerHTML = html;
  window._massMessages = result.messages.map(m => m.text);
}

function copyMassMessage(btn, idx) {
  try {
    var waText = window._massMessages[idx].replace(/\n{3,}/g, '\n\n');
    doCopy(waText);
    btn.classList.add('copied');
    btn.innerHTML = '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M20 6L9 17l-5-5"/></svg> Copiado!';
    showToast();
    setTimeout(function() {
      btn.classList.remove('copied');
      btn.innerHTML = '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg> Copiar mensaje';
    }, 2000);
  } catch(e) { alert('Error al copiar: ' + e.message); }
}

// Add shake animation
const style = document.createElement('style');
style.textContent = `@keyframes shake{0%,100%{transform:translateX(0)}20%,60%{transform:translateX(-6px)}40%,80%{transform:translateX(6px)}}`;
document.head.appendChild(style);
// Error detection for debugging
window.onerror = function(msg, url, line, col, error) {
  alert('Error en linea ' + line + ': ' + msg);
  return false;
};
</script>
</body>
</html>
